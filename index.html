<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donate Way â€” Admin Dashboard (Pi Testnet)</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #6a1b9a; 
            --secondary: #fb8c00; 
            --bg: #f3f4f6; 
            --text: #1f2937; 
            --border: #e5e7eb;
        }
        body { 
            font-family: 'Tajawal', sans-serif; 
            background-color: var(--bg); 
            color: var(--text); 
            margin: 0; 
            display: flex; 
            justify-content: center; 
            align-items: flex-start; 
            min-height: 100vh; 
            padding: 2rem 1rem;
            box-sizing: border-box;
        }
        
        .container { 
            background: white; 
            padding: 2rem; 
            border-radius: 20px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); 
            width: 100%; 
            max-width: 850px; 
        }

        h1 { color: var(--primary); text-align: center; margin-bottom: 0.5rem; }
        p.subtitle { text-align: center; color: #666; font-size: 0.95rem; margin-bottom: 1.5rem; }

        /* Tabs Styling */
        .tabs { 
            display: flex; flex-wrap: wrap; justify-content: center; 
            margin-bottom: 2rem; background: #f9fafb; padding: 5px; 
            border-radius: 12px; border: 1px solid var(--border);
        }
        .tab-btn {
            flex: 1; min-width: 120px; padding: 12px; border: none; background: transparent; 
            font-family: inherit; font-weight: bold; cursor: pointer; 
            border-radius: 8px; transition: 0.3s; color: #6b7280; font-size: 0.95rem;
        }
        .tab-btn.active { 
            background: white; color: var(--primary); 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
        }

        .form-section { display: none; animation: fadeIn 0.4s ease; }
        .form-section.active { display: block; }

        /* Grid for side-by-side inputs */
        .row { display: grid; grid-template-columns: 1fr; gap: 15px; margin-bottom: 1.2rem; }
        @media(min-width: 600px) { .row { grid-template-columns: 1fr 1fr; } }

        .form-group { text-align: right; margin-bottom: 1.2rem;}
        .row .form-group { margin-bottom: 0; }
        
        label { display: block; margin-bottom: 0.5rem; font-weight: bold; color: #374151; font-size: 0.9rem;}
        input, select, textarea { 
            width: 100%; padding: 12px; border: 2px solid var(--border); 
            border-radius: 10px; box-sizing: border-box; font-family: inherit; font-size: 0.95rem;
            transition: 0.2s;
        }
        input:focus, select:focus, textarea:focus { border-color: var(--secondary); outline: none; }
        textarea { min-height: 120px; resize: vertical; }
        
        .hint { font-size: 0.8rem; color: #888; margin-top: 5px; display: block; }

        /* Section dividers */
        .section-divider {
            border: 0; border-top: 2px dashed #e5e7eb; margin: 2rem 0;
        }
        h3.section-title {
            color: #4b5563; font-size: 1.1rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 8px;
        }

        /* Buttons */
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 1rem; }
        .btn { 
            background: #f3f4f6; color: #374151; border: 1px solid var(--border); 
            padding: 12px 20px; border-radius: 10px; font-size: 0.95rem; cursor: pointer; 
            font-weight: bold; transition: 0.3s; font-family: inherit; flex: 1; min-width: 150px;
        }
        .btn:hover { background: #e5e7eb; }
        
        .btn-primary { background: linear-gradient(135deg, var(--primary), #4a148c); color: white; border: none; }
        .btn-primary:hover { opacity: 0.9; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(106, 27, 154, 0.2); }
        
        .btn-secondary { background: linear-gradient(135deg, var(--secondary), #e65100); color: white; border: none; }
        .btn-secondary:hover { opacity: 0.9; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(251, 140, 0, 0.2); }

        /* Output / Logs */
        .log-box {
            margin-top: 1.5rem; padding: 1rem; border-radius: 10px; font-size: 0.85rem; 
            text-align: left; direction: ltr; background: #111827; color: #10b981; 
            font-family: monospace; white-space: pre-wrap; word-break: break-all;
            max-height: 250px; overflow-y: auto; border: 4px solid #374151;
        }

        .alert {
            background: #fffbeb; padding: 12px; border-radius: 8px; margin-bottom: 15px; 
            font-size: 0.85rem; color: #92400e; border: 1px solid #fcd34d; line-height: 1.5;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="container">
        <h1>Ù…Ø¯ÙŠØ± Ø§Ù„Ø£ØµÙˆÙ„ (Pi Network)</h1>
        <p class="subtitle">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ â€” Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø©ØŒ Ø§Ù„Ø³ÙˆÙ‚ØŒ ÙˆØ§Ù„Ø³ÙŠÙˆÙ„Ø© (Testnet)</p>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('dash', this)">Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</button>
            <button class="tab-btn" onclick="switchTab('ops', this)">Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙˆØ§Ù„Ø³ÙŠÙˆÙ„Ø©</button>
            <button class="tab-btn" onclick="switchTab('market', this)">Ù…Ø³ØªÙƒØ´Ù Ø§Ù„Ø³ÙˆÙ‚</button>
            <button class="tab-btn" onclick="switchTab('domain', this)">Ø§Ù„ØªÙˆØ«ÙŠÙ‚ ÙˆØ±Ø¨Ø· Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†</button>
        </div>

        <div id="dash" class="form-section active">
            <div class="alert">
                âš ï¸ <strong>ØªÙ†Ø¨ÙŠÙ‡:</strong> ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ "Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ø£Ø¯Ù…Ù†" Ù„ØªÙ†ÙÙŠØ° Ø£ÙŠ Ø¹Ù…Ù„ÙŠØ© (Ø·Ø¨Ø§Ø¹Ø©ØŒ Ø³ÙŠÙˆÙ„Ø©ØŒ Ø±Ø¨Ø· Ø¯ÙˆÙ…ÙŠÙ†).
            </div>
            
            <div class="row">
                <div class="form-group">
                    <label>Ø±Ù…Ø² Ø§Ù„Ø¹Ù…Ù„Ø© (Asset Code)</label>
                    <input type="text" id="assetCode" value="DONATEWAY" placeholder="Ù…Ø«Ø§Ù„: DEALWAY">
                </div>
                <div class="form-group">
                    <label>Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ø£Ø¯Ù…Ù† (Admin Password)</label>
                    <input type="password" id="adminToken" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø³Ø±ÙŠØ©...">
                </div>
            </div>

            <div class="row">
                <div class="form-group">
                    <label>Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ù…ÙØµØ¯Ø± (Issuer Pub)</label>
                    <input type="text" id="issuerPub" placeholder="GBQ3H...">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ù…ÙˆØ²Ø¹ (Distributor Pub)</label>
                    <input type="text" id="distPub" placeholder="GCLLM...">
                </div>
            </div>

            <div class="btn-group">
                <button class="btn" onclick="saveLocally()">ğŸ’¾ Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹</button>
                <button class="btn btn-primary" onclick="checkAssetHorizon()">ğŸ”„ ÙØ­Øµ Ø§Ù„Ø¹Ù…Ù„Ø© ÙÙŠ Horizon</button>
            </div>
        </div>

        <div id="ops" class="form-section">
            <h3 class="section-title">ğŸ“Œ Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø¹Ù…Ù„Ø© (Bootstrap)</h3>
            <div class="row">
                <div class="form-group">
                    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶ (Display Name)</label>
                    <input type="text" id="displayName" value="Donate Way">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„ÙƒÙ„ÙŠØ© (Initial Supply)</label>
                    <input type="number" id="initialSupply" value="1000000">
                </div>
            </div>
            <button id="btnBootstrap" class="btn btn-primary" style="width: 100%;">ğŸš€ Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø¹Ù…Ù„Ø© ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ù„Ù„Ù…ÙˆØ²Ø¹</button>

            <hr class="section-divider">

            <h3 class="section-title">âš–ï¸ Ø¹Ø±ÙˆØ¶ Ø§Ù„ØªØ¯Ø§ÙˆÙ„ (DEX)</h3>
            <div class="row">
                <div class="form-group">
                    <label>Ø§Ù„ÙƒÙ…ÙŠØ© (Token Amount)</label>
                    <input type="number" id="dexAmount" value="1">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø³Ø¹Ø± (Pi Ù„ÙƒÙ„ ØªÙˆÙƒÙŠÙ†)</label>
                    <input type="number" id="dexPrice" value="0.000001" step="0.000001">
                </div>
            </div>
            <div class="btn-group">
                <button id="btnSellOffer" class="btn">ğŸ“‰ Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø±Ø¶ Ø¨ÙŠØ¹</button>
                <button id="btnBuyOffer" class="btn">ğŸ“ˆ Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø±Ø¶ Ø´Ø±Ø§Ø¡</button>
            </div>

            <hr class="section-divider">

            <h3 class="section-title">ğŸ’§ Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© (AMM)</h3>
            <div class="row">
                <div class="form-group">
                    <label>ÙƒÙ…ÙŠØ© Ø§Ù„ØªÙˆÙƒÙŠÙ† Ù„Ù„Ø¥ÙŠØ¯Ø§Ø¹</label>
                    <input type="number" id="ammTokenAmount" value="5000">
                </div>
                <div class="form-group">
                    <label>ÙƒÙ…ÙŠØ© Pi Ù„Ù„Ø¥ÙŠØ¯Ø§Ø¹</label>
                    <input type="number" id="ammPiAmount" value="50">
                </div>
            </div>
            <div class="row">
                <div class="form-group">
                    <label>Ø£Ù‚Ù„ Ø³Ø¹Ø± (Min Price) - Ø§Ø®ØªÙŠØ§Ø±ÙŠ</label>
                    <input type="text" id="ammMinPrice" placeholder="0.0000001">
                </div>
                <div class="form-group">
                    <label>Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø± (Max Price) - Ø§Ø®ØªÙŠØ§Ø±ÙŠ</label>
                    <input type="text" id="ammMaxPrice" placeholder="10000000">
                </div>
            </div>
            <button id="btnAddAmm" class="btn btn-secondary" style="width: 100%;">âš™ï¸ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ù„Ù„Ù…Ø¬Ù…Ø¹</button>
        </div>

        <div id="market" class="form-section">
            <h3 class="section-title">ğŸ“Š Ø£Ø¯ÙˆØ§Øª Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø´Ø¨ÙƒØ©</h3>
            
            <div class="form-group">
                <label>Ù…Ø¹Ø±Ù Ø§Ù„Ø­Ø³Ø§Ø¨ (Account ID)</label>
                <input type="text" id="offersAccount" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø¹Ø§Ù… G...">
            </div>
            <button class="btn btn-primary" onclick="checkOpenOffers()">ğŸ” Ø¹Ø±Ø¶ ØµÙÙ‚Ø§ØªÙŠ Ø§Ù„Ù…ÙØªÙˆØ­Ø©</button>

            <hr class="section-divider">

            <div class="row">
                <div class="form-group">
                    <label>Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Orderbook)</label>
                    <select id="obMode">
                        <option value="sell_token">Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¨ÙŠØ¹ (Asks)</option>
                        <option value="buy_token">Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø´Ø±Ø§Ø¡ (Bids)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø³Ø¬Ù„</label>
                    <input type="number" id="obLimit" value="20">
                </div>
            </div>
            <div class="btn-group">
                <button class="btn" onclick="loadOrderbook()">ğŸ“‹ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
                <button class="btn" onclick="loadTrades()">ğŸ“œ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</button>
            </div>
            <button class="btn btn-secondary" style="width: 100%; margin-top: 10px;" onclick="checkLiquidityPool()">ğŸ’§ Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠÙˆÙ„Ø© (Pool Info)</button>
        </div>

        <div id="domain" class="form-section">
            <h3 class="section-title">ğŸŒ Ù…ÙˆÙ„Ø¯ Ù…Ù„Ù Ø§Ù„ØªÙˆØ«ÙŠÙ‚ (pi.toml)</h3>
            
            <div class="row">
                <div class="form-group">
                    <label>Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Domain)</label>
                    <input type="text" id="verDomain" value="testapp2026.netlify.app">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ù…ÙØµØ¯Ø±</label>
                    <input type="text" id="verIssuer" placeholder="GBQ3...">
                </div>
            </div>

            <div class="row">
                <div class="form-group">
                    <label>Ø±Ù…Ø² Ø§Ù„Ø¹Ù…Ù„Ø© (Asset Code)</label>
                    <input type="text" id="verAssetCode" value="DONATEWAY">
                </div>
                <div class="form-group">
                    <label>Ø±Ø§Ø¨Ø· Ø§Ù„Ù„ÙˆØ¬Ùˆ (Image URL)</label>
                    <input type="text" id="verImage" value="https://testapp2026.netlify.app/token_512.png">
                </div>
            </div>

            <div class="row">
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¸Ù…Ø© (Org Name)</label>
                    <input type="text" id="verOrgName" value="Donate Way">
                </div>
                <div class="form-group">
                    <label>Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†Ø¸Ù…Ø© (Org URL)</label>
                    <input type="text" id="verOrgUrl" value="https://testapp2026.netlify.app">
                </div>
            </div>

            <div class="form-group">
                <label>Ø§Ù„ÙˆØµÙ (Description)</label>
                <input type="text" id="verDesc" value="Donate Way token on Pi Testnet for donations.">
            </div>

            <button id="btnGenPiToml" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">ğŸ“ ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ pi.toml</button>
            
            <div class="form-group">
                <label>Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù†Ø§ØªØ¬ (Ø§Ù†Ø³Ø®Ù‡ ÙˆØ¶Ø¹Ù‡ ÙÙŠ Ù…Ø³Ø§Ø± .well-known/pi.toml)</label>
                <textarea id="tomlOut" readonly style="background: #f9fafb; direction: ltr; font-family: monospace;"></textarea>
            </div>

            <hr class="section-divider">

            <h3 class="section-title">ğŸ”— Ø±Ø¨Ø· Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ† Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© (Set Home Domain)</h3>
            <div class="row">
                <div class="form-group">
                    <label>Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ† Ø§Ù„Ù…Ø±Ø§Ø¯ Ø±Ø¨Ø·Ù‡ (Ø¨Ø¯ÙˆÙ† https://)</label>
                    <input type="text" id="hdDomain" value="testapp2026.netlify.app">
                    <span class="hint">Ø³ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ† ÙƒÙ€ home_domain Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙØµØ¯Ø± (Issuer).</span>
                </div>
            </div>
            
            <div class="btn-group">
                <button id="btnSetHomeDomain" class="btn btn-secondary">ğŸ”— ØªÙ†ÙÙŠØ° Ø§Ù„Ø±Ø¨Ø·</button>
                <button id="btnGetIssuerInfo" class="btn">ğŸ” ÙØ­Øµ Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ† Ø§Ù„Ù…Ø±Ø¨ÙˆØ· Ø­Ø§Ù„ÙŠØ§Ù‹</button>
            </div>
            
            <div class="form-group" style="margin-top: 1rem;">
                <textarea id="homeDomainOut" readonly style="background: #111827; color: #60a5fa; direction: ltr; font-family: monospace; min-height: 80px; padding: 10px; border-radius: 8px;" placeholder="Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙØ­Øµ ÙˆØ§Ù„Ø±Ø¨Ø· Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§..."></textarea>
            </div>
        </div>

        <div id="logBox" class="log-box">Log Console Ready...</div>
    </div>

    <script>
        // âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„
        const BACKEND_URL = "https://hfit-pi-token.netlify.app";

        // Ø¯Ø§Ù„Ø© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ§Ø¨Ø§Øª
        function switchTab(tabId, btn) {
            document.querySelectorAll('.form-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            btn.classList.add('active');
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø³Ø¬Ù„ (Ø·Ø§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡)
        function log(...args) {
            const line = args.map(a => typeof a === "string" ? a : JSON.stringify(a, null, 2)).join(" ");
            const el = document.getElementById("logBox");
            if (el) {
                const time = new Date().toLocaleTimeString();
                el.textContent = `[${time}] ${line}\n` + el.textContent;
            }
        }

        function normalizeAssetCode(code) {
            return (code || "").toUpperCase().replace(/[^A-Z0-9]/g, "").slice(0, 12);
        }

        function saveLocally() {
            log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹. (ÙˆÙ‡Ù…ÙŠ Ù„Ù„ØªØ¬Ø±Ø¨Ø© ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­)');
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯
        async function apiPost(path, body, adminToken) {
            const fullUrl = BACKEND_URL + path;
            const res = await fetch(fullUrl, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    ...(adminToken ? { "X-Admin-Token": adminToken } : {}),
                },
                body: JSON.stringify(body || {}),
            });
            
            const text = await res.text();
            let data;
            try { data = JSON.parse(text); } catch { data = { raw: text }; }
            
            if (!res.ok) {
                throw new Error(data?.error || data?.message || `HTTP ${res.status}: ${text}`);
            }
            return data;
        }

        // ==========================================
        // Ø¥Ø¶Ø§ÙØ§Øª Ø¯ÙˆØ§Ù„ Horizon API (Ù…Ø³ØªÙƒØ´Ù Ø§Ù„Ø³ÙˆÙ‚ ÙˆØ§Ù„Ø´Ø¨ÙƒØ©)
        // ==========================================

        async function checkAssetHorizon() {
            const assetCode = normalizeAssetCode(document.getElementById("assetCode").value);
            const issuerPub = document.getElementById("issuerPub").value.trim() || document.getElementById("verIssuer").value.trim();
            if (!assetCode || !issuerPub) return log("âŒ Ø®Ø·Ø£: ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„Ø¹Ù…Ù„Ø© ÙˆØ§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ù…ÙØµØ¯Ø± ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø£ÙˆÙ„Ø§Ù‹.");
            
            try {
                log(`â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„Ø© ${assetCode} ÙÙŠ Ø´Ø¨ÙƒØ© Pi Testnet...`);
                const res = await fetch(`https://api.testnet.minepi.com/assets?asset_code=${assetCode}&asset_issuer=${issuerPub}`);
                const data = await res.json();
                if (data._embedded && data._embedded.records.length > 0) {
                    log("âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­:", data._embedded.records[0]);
                } else {
                    log("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„Ø©. Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¥ØµØ¯Ø§Ø±Ù‡Ø§ Ø£ÙˆÙ„Ø§Ù‹.");
                }
            } catch (e) { log("âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©:", e.message); }
        }

        async function checkOpenOffers() {
            const accountId = document.getElementById("offersAccount").value.trim();
            if (!accountId) return log("âŒ Ø®Ø·Ø£: ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ø­Ø³Ø§Ø¨ (Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø¹Ø§Ù…) Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¹Ø±ÙˆØ¶.");
            
            try {
                log(`â³ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù†Ø´Ø·Ø© Ù„Ù„Ø­Ø³Ø§Ø¨ ${accountId.slice(0,8)}...`);
                const res = await fetch(`https://api.testnet.minepi.com/accounts/${accountId}/offers`);
                const data = await res.json();
                if (data._embedded && data._embedded.records.length > 0) {
                    log(`âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${data._embedded.records.length} Ø¹Ø±ÙˆØ¶ Ù†Ø´Ø·Ø©:`, data._embedded.records);
                } else {
                    log("â„¹ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ ØªØ¯Ø§ÙˆÙ„ Ù†Ø´Ø·Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨.");
                }
            } catch (e) { log("âŒ ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ø±ÙˆØ¶:", e.message); }
        }

        async function loadOrderbook() {
            const assetCode = normalizeAssetCode(document.getElementById("assetCode").value);
            const issuerPub = document.getElementById("issuerPub").value.trim() || document.getElementById("verIssuer").value.trim();
            const limit = document.getElementById("obLimit").value || 20;

            if (!assetCode || !issuerPub) return log("âŒ Ø®Ø·Ø£: Ø±Ù…Ø² Ø§Ù„Ø¹Ù…Ù„Ø© Ø£Ùˆ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ù…ØµØ¯Ø± Ù…ÙÙ‚ÙˆØ¯ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©.");
            
            try {
                log(`â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Bids & Asks)...`);
                // Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ Ø¥Ù† Ø§Ù„ØªØ¯Ø§ÙˆÙ„ ÙŠØªÙ… Ù…Ù‚Ø§Ø¨Ù„ Ø¹Ù…Ù„Ø© Pi Ø§Ù„Ø£ØµÙ„ÙŠØ© (Native)
                const url = `https://api.testnet.minepi.com/order_book?selling_asset_type=credit_alphanum12&selling_asset_code=${assetCode}&selling_asset_issuer=${issuerPub}&buying_asset_type=native&limit=${limit}`;
                const res = await fetch(url);
                const data = await res.json();
                log("âœ… Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:", data);
            } catch (e) { log("âŒ ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¬Ù„:", e.message); }
        }

        async function loadTrades() {
             const accountId = document.getElementById("offersAccount").value.trim();
             if (!accountId) return log("âŒ Ø®Ø·Ø£: ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„Ø¬Ù„Ø¨ Ø§Ù„ØµÙÙ‚Ø§Øª.");
             
             try {
                log(`â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©...`);
                const res = await fetch(`https://api.testnet.minepi.com/accounts/${accountId}/trades?limit=20`);
                const data = await res.json();
                log("âœ… Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©:", data._embedded ? data._embedded.records : data);
             } catch (e) { log("âŒ ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„ØµÙÙ‚Ø§Øª:", e.message); }
        }

        async function checkLiquidityPool() {
            const assetCode = normalizeAssetCode(document.getElementById("assetCode").value);
            const issuerPub = document.getElementById("issuerPub").value.trim() || document.getElementById("verIssuer").value.trim();
            if (!assetCode || !issuerPub) return log("âŒ Ø®Ø·Ø£: Ù†Ø­ØªØ§Ø¬ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ù…ØµØ¯Ø± ÙˆØ±Ù…Ø² Ø§Ù„Ø¹Ù…Ù„Ø© Ù„ÙØ­Øµ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©.");
            
            try {
                log("â³ Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ù…Ø¬Ù…Ø¹Ø§Øª Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø¹Ù…Ù„Ø©...");
                const url = `https://api.testnet.minepi.com/liquidity_pools?reserves=native,credit_alphanum12:${assetCode}:${issuerPub}`;
                const res = await fetch(url);
                const data = await res.json();
                if (data._embedded && data._embedded.records.length > 0) {
                    log("âœ… ØªÙØ§ØµÙŠÙ„ Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© (Pool Info):", data._embedded.records[0]);
                } else {
                    log(`â„¹ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¬Ù…Ø¹ Ø³ÙŠÙˆÙ„Ø© Ù†Ø´Ø· Ù„Ø²ÙˆØ¬ (Pi / ${assetCode}).`);
                }
            } catch (e) { log("âŒ ÙØ´Ù„ ÙØ­Øµ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©:", e.message); }
        }

        // ==========================================
        // Ø±Ø¨Ø· Ø£Ø­Ø¯Ø§Ø« Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø¨Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ (Netlify)
        // ==========================================

        // 1. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„Ø© (Bootstrap)
        const btnBootstrap = document.getElementById("btnBootstrap");
        if (btnBootstrap) {
            btnBootstrap.addEventListener("click", async () => {
                const displayName = document.getElementById("displayName").value.trim();
                const assetCode = normalizeAssetCode(document.getElementById("assetCode").value);
                document.getElementById("assetCode").value = assetCode;
                
                const initialSupply = document.getElementById("initialSupply").value.trim();
                const adminToken = document.getElementById("adminToken").value.trim();
                
                if (!adminToken) return log("âŒ Ø®Ø·Ø£: ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ø£Ø¯Ù…Ù† ÙÙŠ ØªØ¨ÙˆÙŠØ¨Ø© Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø£ÙˆÙ„Ø§Ù‹.");
                if (!assetCode) return log("âŒ Ø®Ø·Ø£: Asset Code Ù…ÙÙ‚ÙˆØ¯.");
                
                try {
                    log(`â³ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„Ø© (${assetCode})...`);
                    const data = await apiPost("/.netlify/functions/token_bootstrap", {
                        displayName, assetCode, initialSupply,
                    }, adminToken);
                    log("âœ… ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­:", data);
                } catch (e) {
                    log("âŒ ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„Ø©:", e.message || e);
                }
            });
        }

        // 2. Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø±Ø¶ Ø¨ÙŠØ¹ (DEX)
        const btnSellOffer = document.getElementById("btnSellOffer");
        if (btnSellOffer) {
            btnSellOffer.addEventListener("click", async () => {
                const assetCode = normalizeAssetCode(document.getElementById("assetCode").value);
                const amount = document.getElementById("dexAmount").value.trim();
                const price = document.getElementById("dexPrice").value.trim();
                const adminToken = document.getElementById("adminToken").value.trim();
                
                if (!adminToken) return log("âŒ Ø®Ø·Ø£: Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ø£Ø¯Ù…Ù† Ù…Ø·Ù„ÙˆØ¨.");
                
                try {
                    log(`â³ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø±Ø¶ Ø¨ÙŠØ¹ (${amount} ØªÙˆÙƒÙŠÙ† Ø¨Ø³Ø¹Ø± ${price})...`);
                    const data = await apiPost("/.netlify/functions/dex_sell_offer", {
                        assetCode, amount, price,
                    }, adminToken);
                    log("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ù†Ø¬Ø§Ø­:", data);
                } catch (e) {
                    log("âŒ ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ø±Ø¶:", e.message || e);
                }
            });
        }

        // 3. Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³ÙŠÙˆÙ„Ø© (AMM)
        const btnAddAmm = document.getElementById("btnAddAmm");
        if (btnAddAmm) {
            btnAddAmm.addEventListener("click", async () => {
                const assetCode = normalizeAssetCode(document.getElementById("assetCode").value);
                const tokenAmount = document.getElementById("ammTokenAmount").value.trim();
                const piAmount = document.getElementById("ammPiAmount").value.trim();
                const minPrice = document.getElementById("ammMinPrice").value.trim();
                const maxPrice = document.getElementById("ammMaxPrice").value.trim();
                const adminToken = document.getElementById("adminToken").value.trim();

                if (!adminToken) return log("âŒ Ø®Ø·Ø£: Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ø£Ø¯Ù…Ù† Ù…Ø·Ù„ÙˆØ¨.");

                try {
                    log(`â³ Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ù„Ù„Ù…Ø¬Ù…Ø¹ (${tokenAmount} ØªÙˆÙƒÙŠÙ† + ${piAmount} Pi)...`);
                    const data = await apiPost("/.netlify/functions/amm_add_liquidity", {
                        assetCode, tokenAmount, piAmount, minPrice, maxPrice
                    }, adminToken);
                    log("âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø¨Ù†Ø¬Ø§Ø­:", data);
                } catch (e) {
                    log("âŒ ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³ÙŠÙˆÙ„Ø©:", e.message || e);
                }
            });
        }

        // 4. ØªÙˆÙ„ÙŠØ¯ Ù…Ù„Ù pi.toml
        const btnGenPiToml = document.getElementById("btnGenPiToml");
        if (btnGenPiToml) {
            btnGenPiToml.addEventListener("click", () => {
                const domain = document.getElementById("verDomain").value.trim();
                const issuer = document.getElementById("verIssuer").value.trim();
                const assetCode = document.getElementById("verAssetCode").value.trim();
                const image = document.getElementById("verImage").value.trim();
                const orgName = document.getElementById("verOrgName").value.trim();
                const orgUrl = document.getElementById("verOrgUrl").value.trim();
                const desc = document.getElementById("verDesc").value.trim();

                if (!issuer || !assetCode) {
                    return log("âŒ Ø®Ø·Ø£: ÙŠØ¬Ø¨ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù€ Issuer Public Key ÙˆØ§Ù„Ù€ Asset Code");
                }

                const tomlString = `
# Network Info
NETWORK_PASSPHRASE="Pi Testnet"
HORIZON_URL="https://api.testnet.minepi.com"

# Organization Info
ORG_NAME="${orgName}"
ORG_URL="${orgUrl}"
ORG_DESCRIPTION="${desc}"
ORG_LOGO="${image}"

# Token Info
[[CURRENCIES]]
code="${assetCode}"
issuer="${issuer}"
display_decimals=7
name="${orgName} Token"
desc="${desc}"
image="${image}"
`.trim();

                document.getElementById("tomlOut").value = tomlString;
                log("âœ… ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ù…Ø­ØªÙˆÙ‰ Ù…Ù„Ù pi.toml Ø¨Ù†Ø¬Ø§Ø­ (Ø±Ø§Ø¬Ø¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø©).");
            });
        }

        // 5. Ø±Ø¨Ø· Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ† (Set Home Domain)
        const btnSetHomeDomain = document.getElementById("btnSetHomeDomain");
        if (btnSetHomeDomain) {
            btnSetHomeDomain.addEventListener("click", async () => {
                const domain = document.getElementById("hdDomain").value.trim();
                const adminToken = document.getElementById("adminToken").value.trim();
                const assetCode = normalizeAssetCode(document.getElementById("assetCode").value);

                if (!adminToken) return log("âŒ Ø®Ø·Ø£: Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ø£Ø¯Ù…Ù† Ù…Ø·Ù„ÙˆØ¨ (ÙŠÙØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„Ù‡ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©).");
                if (!domain) return log("âŒ Ø®Ø·Ø£: ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ† Ø§Ù„Ù…Ø±Ø§Ø¯ Ø±Ø¨Ø·Ù‡.");

                try {
                    log(`â³ Ø¬Ø§Ø±ÙŠ Ø±Ø¨Ø· Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ† (${domain}) Ø¨Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙØµØ¯Ø±...`);
                    document.getElementById("homeDomainOut").value = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…...";
                    
                    const data = await apiPost("/.netlify/functions/set_domain", {
                        domain: domain,
                        assetCode: assetCode
                    }, adminToken);
                    
                    log("âœ… ØªÙ… Ø±Ø¨Ø· Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­:", data);
                    document.getElementById("homeDomainOut").value = "ØªÙ… Ø§Ù„Ø±Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­:\n" + JSON.stringify(data, null, 2);
                } catch (e) {
                    log("âŒ ÙØ´Ù„ Ø±Ø¨Ø· Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†:", e.message || e);
                    document.getElementById("homeDomainOut").value = "Ø­Ø¯Ø« Ø®Ø·Ø£:\n" + (e.message || e);
                }
            });
        }

        // 6. ÙØ­Øµ Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ† Ø§Ù„Ù…Ø±Ø¨ÙˆØ· (Check Issuer Info)
        const btnGetIssuerInfo = document.getElementById("btnGetIssuerInfo");
        if (btnGetIssuerInfo) {
            btnGetIssuerInfo.addEventListener("click", async () => {
                const issuerPub = document.getElementById("verIssuer").value.trim() || document.getElementById("issuerPub").value.trim();
                
                if (!issuerPub) {
                    return log("âŒ Ø®Ø·Ø£: ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ù…ÙØµØ¯Ø± ÙÙŠ Ø®Ø§Ù†Ø© (Issuer Public Key) Ø£ÙˆÙ„Ø§Ù‹.");
                }

                try {
                    log(`â³ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙØµØ¯Ø± Ù…Ù† Ø´Ø¨ÙƒØ© Pi...`);
                    document.getElementById("homeDomainOut").value = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Horizon API...";
                    
                    const res = await fetch(`https://api.testnet.minepi.com/accounts/${issuerPub}`);
                    if (!res.ok) throw new Error("Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ Ø£Ùˆ Ù„Ù… ÙŠØªÙ… ØªÙØ¹ÙŠÙ„Ù‡ Ø¨Ø¹Ø¯.");
                    
                    const data = await res.json();
                    
                    if (data.home_domain) {
                        log(`âœ… Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ† Ø§Ù„Ù…Ø±Ø¨ÙˆØ· Ø­Ø§Ù„ÙŠØ§Ù‹ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù‡Ùˆ: ${data.home_domain}`);
                        document.getElementById("homeDomainOut").value = `Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ† Ø§Ù„Ù…Ø±Ø¨ÙˆØ· Ø­Ø§Ù„ÙŠØ§Ù‹:\n${data.home_domain}\n\nØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨:\n${JSON.stringify(data, null, 2)}`;
                    } else {
                        log(`âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙŠ Ø¯ÙˆÙ…ÙŠÙ† (home_domain) Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.`);
                        document.getElementById("homeDomainOut").value = `Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯ÙˆÙ…ÙŠÙ† Ù…Ø±Ø¨ÙˆØ·.\n\nØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨:\n${JSON.stringify(data, null, 2)}`;
                    }
                } catch (e) {
                    log("âŒ ÙØ´Ù„ ÙØ­Øµ Ø§Ù„Ø­Ø³Ø§Ø¨:", e.message || e);
                    document.getElementById("homeDomainOut").value = "Ø­Ø¯Ø« Ø®Ø·Ø£:\n" + (e.message || e);
                }
            });
        }

        log("âœ… Dashboard Initialized. Admin Mode Active.");
    </script>
</body>
</html>
